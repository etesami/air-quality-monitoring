FROM golang:1.23 AS build

WORKDIR /app

COPY go.mod go.sum ./
RUN go mod download

COPY . .

RUN go build -o dashboard cmd/main.go

FROM alpine:3.21.3

WORKDIR /root/
COPY --from=build /app/dashboard .

ARG SVC_AGGR_STRG_ADDR
ARG SVC_AGGR_STRG_PORT
ARG SVC_DASH_METRIC_ADDR
ARG SVC_DASH_METRIC_PORT
# Frequency in seconds
ARG SVC_DASH_UPDATE_FREQUENCY

ENV SVC_TA_AGGR_STRG_ADDR=${SVC_AGGR_STRG_ADDR}
ENV SVC_TA_AGGR_STRG_PORT=${SVC_AGGR_STRG_PORT}
ENV SVC_LO_DASH_METRIC_ADDR=${SVC_DASH_METRIC_ADDR}
ENV SVC_LO_DASH_METRIC_PORT=${SVC_DASH_METRIC_PORT}
ENV SVC_LO_DASH_UPDATE_FREQUENCY=${SVC_DASH_UPDATE_FREQUENCY}

EXPOSE 50052
CMD ["./dashboard"]
