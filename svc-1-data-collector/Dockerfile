FROM golang:1.23 AS build

WORKDIR /app

COPY go.mod go.sum ./
RUN go mod download

COPY . .

RUN go build -o collector cmd/main.go

FROM alpine:latest

WORKDIR /root/
COPY --from=build /app/collector .

ARG LAT1
ARG LNG1
ARG LAT2
ARG LNG2
ARG TOKEN
ARG SVC_INGESTION_ADDR
ARG SVC_INGESTION_PORT
ARG SVC_METRIC_ADDR
ARG SVC_METRIC_PORT
# Frequency in minutes
ARG UPDATE_FREQUENCY

ENV LAT1=${LAT1}
ENV LNG1=${LNG1}
ENV LAT2=${LAT2}
ENV LNG2=${LNG2}
ENV TOKEN=${TOKEN}
ENV SVC_TA_INGESTION_ADDR=${SVC_INGESTION_ADDR}
ENV SVC_TA_INGESTION_PORT=${SVC_INGESTION_PORT}
ENV SVC_LO_COLC_METRIC_ADDR=${SVC_METRIC_ADDR}
ENV SVC_LO_COLC_METRIC_PORT=${SVC_METRIC_PORT}
ENV SVC_LO_COLC_UPDATE_FREQUENCY=${UPDATE_FREQUENCY}

EXPOSE 50052
CMD ["./collector"]
